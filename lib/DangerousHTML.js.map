{"version":3,"sources":["../src/DangerousHTML.js"],"names":["replaceScriptElementsRecursive","node","acc","tagName","id","indexOf","script","document","createElement","Math","random","toString","slice","innerHTML","attrs","attributes","i","length","name","value","setAttribute","push","parentElement","replaceChild","children","childNodes","removeScriptElements","scriptElements","parentEl","removeChild","DangerousHTML","state","canRenderHTML","element","props","html","setState","insertScriptsIfNeeded","prepareAnchors","nextProps","nextState","prevProps","prevState","anchors","call","querySelectorAll","forEach","a","className","TagName","__html","Component","propTypes","string","isRequired","defaultProps"],"mappings":"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","file":"DangerousHTML.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\n\nfunction replaceScriptElementsRecursive(node, acc) {\n  if (node.tagName === 'SCRIPT' && (!node.id || node.id.indexOf('script-') !== 0)) {\n    const script = document.createElement('script');\n\n    script.id = `script-${Math.random()\n      .toString(16)\n      .slice(2)}`;\n    script.innerHTML = node.innerHTML;\n\n    const attrs = node.attributes;\n\n    for (let i = 0; i < attrs.length; i += 1) {\n      const { name, value } = attrs[i];\n\n      script.setAttribute(name, value);\n    }\n\n    acc.push(script);\n    node.parentElement.replaceChild(script, node);\n  } else {\n    let i = 0;\n    const children = node.childNodes;\n\n    while (i < children.length) {\n      replaceScriptElementsRecursive(children[i], acc);\n      i += 1;\n    }\n  }\n}\n\nfunction removeScriptElements(scriptElements) {\n  let i = 0;\n\n  while (i < scriptElements.length) {\n    const parentEl = scriptElements[i].parentElement;\n\n    if (parentEl) {\n      parentEl.removeChild(scriptElements[i]);\n    }\n\n    i += 1;\n  }\n\n  return [];\n}\n\nclass DangerousHTML extends React.Component {\n  static propTypes = {\n    html: PropTypes.string.isRequired,\n    tagName: PropTypes.string,\n    className: PropTypes.string\n  };\n\n  static defaultProps = {\n    tagName: 'div',\n    className: ''\n  };\n\n  state = {\n    canRenderHTML: true\n  };\n\n  componentWillMount() {\n    // Do not render html with scripts on server side\n    if (this.props.html.indexOf('script') > -1) {\n      this.setState({ canRenderHTML: false });\n    }\n  }\n\n  componentDidMount() {\n    /* eslint-disable react/no-did-mount-set-state */\n    this.setState({ canRenderHTML: true }, () => {\n      this.insertScriptsIfNeeded();\n      this.prepareAnchors();\n    });\n    /* eslint-enable react/no-did-mount-set-state */\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.html !== this.props.html) {\n      this.scriptElements = removeScriptElements(this.scriptElements);\n    }\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return (\n      nextProps.html !== this.props.html ||\n      nextState.canRenderHTML !== this.state.canRenderHTML\n    );\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (\n      prevProps.html !== this.props.html ||\n      (!prevState.canRenderHTML && this.state.canRenderHTML)\n    ) {\n      this.insertScriptsIfNeeded();\n      this.prepareAnchors();\n    }\n  }\n\n  componentWillUnmount() {\n    this.scriptElements = removeScriptElements(this.scriptElements);\n  }\n\n  element = null;\n  scriptElements = [];\n\n  insertScriptsIfNeeded() {\n    const { html } = this.props;\n\n    if (html.indexOf('script') > -1 && this.element) {\n      this.element.innerHTML = html;\n\n      replaceScriptElementsRecursive(this.element, this.scriptElements);\n    }\n  }\n\n  prepareAnchors() {\n    if (!this.element) {\n      return;\n    }\n\n    const anchors = [].slice.call(this.element.querySelectorAll('a'), 0);\n\n    anchors.forEach(a => {\n      a.setAttribute('target', '_blank');\n    });\n  }\n\n  render() {\n    const { html, className, tagName: TagName } = this.props;\n    const { canRenderHTML } = this.state;\n\n    if (!canRenderHTML) {\n      return null;\n    }\n\n    return (\n      <TagName\n        ref={element => {\n          this.element = element;\n        }}\n        className={className}\n        dangerouslySetInnerHTML={{ __html: html }}\n      />\n    );\n  }\n}\n\nexport default DangerousHTML;\n"]}